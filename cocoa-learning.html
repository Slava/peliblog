<!DOCTYPE html>
<html lang="en">

<head>
  <!-- <link rel="stylesheet/less" type="text/css" href="http://devblog.me/theme/css/style.less"> -->
  <!-- <script src="http://devblog.me/theme/js/less-1.5.0.min.js" type="text/javascript"></script> -->
  <link rel="stylesheet" type="text/css" href="http://devblog.me/theme/css/style.css">

  <link rel="stylesheet" type="text/css" href="http://devblog.me/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Slava Kim">
  <meta name="description" content="Posts and writings by Slava Kim">


    
    <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type= "text/javascript">
       MathJax.Hub.Config({
           config: ["MMLorHTML.js"],
           jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML"],
           TeX: { extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"], equationNumbers: { autoNumber: "AMS" } },
           extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js"],
           tex2jax: { 
               inlineMath: [ ['$','$'] ],
               displayMath: [ ['$$','$$'] ],
               processEscapes: true },
           "HTML-CSS": {
               styles: { ".MathJax .mo, .MathJax .mi": {color: "black ! important"}}
           }
       });
    </script>


<meta name="keywords" content="">

  <title>
Cocoa learning  </title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37747647-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="http://devblog.me">
        <img src="http://devblog.me/theme/images/logo.png" alt="logo">
      </a>
      <h2><a href="http://devblog.me">Slava Kim</a></h2>
      <p>Learning to code since 2008</p>
      <ul>
        <li><a href="https://github.com/slava" target="_blank">My GitHub</a></li>
        <li><a href="https://twitter.com/imslavko" target="_blank">Me on Twitter</a></li>
        <li><a href="http://slv.io/" target="_blank">More about me</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
<p>Posted on Tue 15 January 2013</p>
    </header>

<article>
  <div class="article_title">
    <h3><a href="http://devblog.me/cocoa-learning.html">Cocoa learning</a></h3>
  </div>
  <div class="article_text">
    <p>Recently I started learning Objective-C and Cocoa framework. I thought it would be easy as I already have some experience with C# and Java. But it appears to be not that easy. Here are some notes I took to map Objective-C to C#.</p>
<h3>Objective-C</h3>
<ul>
<li>Weakly typed</li>
<li>Object oriented</li>
<li>Has manual memory management (Arc)</li>
<li>Uses LLVM or GCC compiler</li>
<li>Using LLVM we can combine C, C++, Objective-C code in one file</li>
</ul>
<h3>Cocoa</h3>
<p>Three main frameworks:</p>
<ul>
<li>Foundation (Strings, Dates, etc)</li>
<li>AppKit (UI related framework)</li>
<li>Core Data (persistence framework)</li>
</ul>
<h3>Naming conventions</h3>
<ul>
<li><code>NSObject</code> class names are capitalized</li>
<li><code>dealloc</code> method names are started with lowercase</li>
<li>camelCase for local vars</li>
</ul>
<h3>Some new info for me</h3>
<ul>
<li>Instance variables that are pointers to other objects are called outlets. </li>
<li>Methods that can be triggered by user interface objects are called actions.</li>
<li>Single inheritance</li>
<li>Objective-C keywords are prefixed with <code>@</code> sign</li>
<li>Option+Click on any piece of code shows docs</li>
<li><code>@</code> sign before string literal means Objective-C string class <code>NSString</code></li>
<li>NSLog has printf-like syntax, but has different identifiers (<code>%d</code>, <code>%qi</code> for <code>long long</code>, <code>hi</code> for <code>short</code>, etc)</li>
<li>In NSLog <code>%@</code> accepts object pointer and expands it to string by calling <code>[obj description]</code>.</li>
<li><code>NSObject.isEqual:anotherObject</code> by default compares pointers</li>
<li>Methods starting with <code>-</code> are instance methods, starting with <code>+</code> are class methods, or static methods</li>
<li>ARC - automatic reference count is GC and can be disabled for project for manual memory management</li>
<li>To get selector for method use macros <code>@selector(method-name)</code>.</li>
<li>Document-based application means application runs several copies of itself per opened file, like text editor. System Preferences, for example, is not a document-based application.</li>
</ul>
<h3>Some types and constants</h3>
<ul>
<li><code>id</code> is pointer to any type of object</li>
<li><code>BOOL</code> is the same as <code>char</code> but is used as Boolean</li>
<li><code>YES</code> is 1, <code>NO</code> is 0</li>
<li>IBOutlet is a macro that avaluates to nothing. Ignore it. (<code>IBOutlet</code> is a hint to Interface Builder).</li>
<li>IBAction is the same as <code>void</code>. It also acts as a hint to Interface Builder</li>
<li><code>nil</code> is the same as NULL. We use <code>nil</code> instread of <code>NULL</code> for poiners to objects.</li>
<li><code>NSArray</code> can not have <code>nil</code> in it</li>
<li><code>NSArray</code>, <code>NSNumber</code> and <code>NSString</code> are immutable</li>
</ul>
<h3>Manual memory management rules</h3>
<ul>
<li>If you create an object by using a method whose name starts with <code>alloc</code> or <code>new</code> or contains <code>copy</code>, you have taken ownership of it. (That is, assume that the new object has a retain count of 1 and is not in the <code>autorelease pool</code>.) You have a responsibility to release the object when you no longer need it. Some of the common methods that convey ownership are <code>alloc</code> (which is always followed by an <code>init</code> method), <code>copy</code>, and <code>mutableCopy</code>.</li>
<li>An object created through any other means, such as a convenience method, is not owned by you. (That is, assume that it has a retain count of 1 and is already in the autorelease pool and thus doomed unless it is retained before the autorelease pool is drained.)</li>
<li>If you donâ€™t own an object and want to ensure its continued existence, take ownership by sending it the message retain. (This increments the retain count.)</li>
<li>When you own an object and no longer need it, send it the message <code>release</code> or <code>autorelease</code>. (The message release decrements the retain count immediately; autorelease causes the message release to get sent when the <code>autorelease pool</code> is drained.)</li>
<li>As long as it has at least one owner, an object will continue to exist- (When its retain count goes to zero, it is sent the message <code>dealloc</code>.)</li>
</ul>
<h3>Controls</h3>
<h4><code>NSButton</code></h4>
<p>Can be oval, square, checkbox. Most common messages sent to buttons:</p>
<div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setEnabled:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">yn</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">state</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setState:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">aState</span>
</pre></div>


<h4><code>NSSlider</code></h4>
<p>Used to select values in ranges. Can be vertical, horizontal and circular. Can send messages continiously while dragging and can send once on mouse button release. Can have markers and prevent selecting values between markers. Two most used messages:</p>
<div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setFloatValue:</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="nv">x</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="nf">floatValue</span>
</pre></div>


<h4><code>NSField</code></h4>
<p>Single line input field. Uneditable fields are used as labels.  <code>NSSecureTextField</code> is subclass which is used for passwords. </p>
<div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">stringValue</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setStringValue:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">aString</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSObject</span> <span class="o">*</span><span class="p">)</span><span class="nf">objectValue</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setObjectValue:</span><span class="p">(</span><span class="n">NSObject</span> <span class="o">*</span><span class="p">)</span><span class="nv">obj</span>
</pre></div>


<p>Second pair is used in case you use <code>NSFormatter</code>s or just <code>description</code> method of object.</p>
<h3>temp</h3>
<ul>
<li>
<p>You can programmatically set actions to methods:</p>
<p><code>objectivec
SEL mySelector;
mySelector = @selector(drawMickey:);
[myButton setAction:mySelector];</code>
- For selector at runtime from string use <code>NSSelectorFromString(@"drawMickey:");</code>.</p>
</li>
</ul>
<h3>Helper objects</h3>
<p>Many classes in the Cocoa framework have an instance variable called <code>delegate</code>, you can set the <code>delegate</code> outlet to point to a helper object. After some events occur class will refer to helper object. You do not need to implement all helper methods described in documentation. Unimplemented methods will be ignored.</p>
<p>So helper object is object that implements certain protocol (<code>interface</code> in Java).
BTW syntax of implementing protocol:</p>
<div class="highlight"><pre><span class="k">@interface</span> <span class="nc">ClassName</span> : <span class="nc">ParentClass</span> <span class="o">&lt;</span><span class="n">Interface1</span><span class="p">,</span> <span class="n">Interface2</span><span class="p">,</span> <span class="p">...</span> <span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// vars</span>
<span class="p">}</span>

<span class="c1">// methods</span>
<span class="c1">// properties</span>

<span class="k">@end</span>
</pre></div>


<h3>Key-Value Coding</h3>
<p>Similarly to to JS, we can refer to objects instance property by string key.</p>
<div class="highlight"><pre><span class="k">@interface</span> <span class="nc">Student</span> : <span class="nc">NSObject</span>
<span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">firstName</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="err">@</span><span class="n">ends</span>
<span class="p">...</span>
<span class="n">Student</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Student</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
<span class="p">[</span><span class="n">s</span> <span class="n">setValue</span><span class="o">:</span><span class="s">@&quot;Larry&quot;</span> <span class="n">forKey</span><span class="o">:</span><span class="s">@&quot;firstName&quot;</span><span class="p">];</span>
<span class="n">NSString</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="n">valueForKey</span><span class="o">:</span><span class="s">@&quot;firstName&quot;</span><span class="p">];</span>
</pre></div>


<p>KVC works in pair with binding to GUI, which does not work with direct access to variable. If there are getters and setters for variable, they will be used by methods <code>setValue:forKey:</code> and <code>valueForKey:</code> only if names of getter and setter satisfy convention <code>foo</code> and <code>setFoo</code> for property <code>foo</code>.</p>
<p>To make other methods affect to bindings, use getters-setters or KVC for changing variable.</p>
<h3>Attributes of property</h3>
<p>Syntax for attribute:</p>
<div class="highlight"><pre><span class="k">@property</span> <span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="n">type</span> <span class="n">name</span><span class="p">;</span>
</pre></div>


<p>Types of attributes (copy-paste from book):
- <code>assign</code> (the default) makes a simple assignment happen. This attribute is most commonly used for scalar, nonpointer types, such as integers and floating-point values.
- <code>strong</code> says that this property is a strong reference. It keeps the object being pointed to from being deallocated while this pointer is set. It is specific to ARC code; if you are not using ARC, the retain attribute is equivalent.
- <code>weak</code> denotes a weak reference. It is similar to assign, except that once the object being pointed to is deallocated, this property will be set to nil. It is supported only by code compiled with ARC.
- <code>copy</code> makes a copy of the new value and assigns the variable to the copy. This attribute is often used for properties that are strings and other classes with mutable subclasses.</p>
<p>There is also <code>nonatomic</code> which is self-explanatory, by default getters and setters are atomic.</p>
<h3>Key pathes</h3>
<p>If you look better, objects create directed graph. So to any object we can find several pathes, including that starts in itself. You can use it to access variable:</p>
<div class="highlight"><pre><span class="n">NSString</span> <span class="o">*</span><span class="n">mn</span> <span class="o">=</span> <span class="p">[</span><span class="n">selectedPerson</span> <span class="n">valueForKeyPath</span><span class="o">:</span><span class="s">@&quot;spouse.scooter.modelName&quot;</span><span class="p">];</span>
</pre></div>


<p>You even can use operators in pathes such as <code>@avg</code>, <code>@count</code>, <code>@max</code>, <code>@min</code>, <code>@sum</code>:</p>
<div class="highlight"><pre><span class="n">NSNumber</span> <span class="o">*</span><span class="n">theAverage</span> <span class="o">=</span> <span class="p">[</span><span class="n">employees</span> <span class="n">valueForKeyPath</span><span class="o">:</span><span class="s">@&quot;@avg.expectedRaise&quot;</span><span class="p">];</span>
</pre></div>


<h3>Programmatical binding</h3>
<p>You can bind programmatically one object to another using pathes:</p>
<div class="highlight"><pre><span class="p">[</span><span class="n">textField</span> <span class="n">bind</span><span class="o">:</span><span class="s">@&quot;value&quot;</span> <span class="n">toObject</span><span class="o">:</span><span class="n">employeeController</span> <span class="n">withKeyPath</span><span class="o">:</span><span class="s">@&quot;arrangedObjects.@avg.expectedRaise&quot;</span> <span class="n">options</span><span class="o">:</span><span class="nb">nil</span><span class="p">];</span>
</pre></div>


<p>And unbind:</p>
<div class="highlight"><pre><span class="p">[</span><span class="n">textField</span> <span class="n">unbind</span><span class="o">:</span><span class="s">@&quot;value&quot;</span><span class="p">];</span>
</pre></div>


<h3>Programmatically add observer</h3>
<p>Similarly to C#'s <code>+=</code> and <code>-=</code> event operators(but less functionally reach) you can add observer for value:</p>
<div class="highlight"><pre><span class="p">[</span><span class="n">theAppDelegate</span> <span class="n">addObserver</span><span class="o">:</span><span class="n">self</span>
                 <span class="nl">forKeyPath:</span><span class="s">@&quot;fido&quot;</span>
                    <span class="nl">options:</span><span class="n">NSKeyValueChangeOldKey</span>
                    <span class="nl">context:</span><span class="n">somePointer</span><span class="p">];</span>
</pre></div>


<p>The method that is triggered looks like this:</p>
<div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">observeValueForKeyPath:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">keyPath</span>
                      <span class="nl">ofObject:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">object</span>
                        <span class="nl">change:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">change</span>
                       <span class="nl">context:</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">context</span>
<span class="p">{</span>
<span class="p">...</span>
<span class="p">}</span>
</pre></div>


<h3>My mappings for Cocoa objects</h3>
<ul>
<li><code>NSMutableArray &lt;=&gt; vector</code></li>
<li><code>NSString &lt;=&gt; string</code></li>
<li><code>for (LotteryEntry *entryToPrint in array) &lt;=&gt; foreach</code></li>
<li><code>NSAssert &lt;=&gt; assert</code></li>
<li><code>interface + implementation &lt;=&gt; class</code></li>
<li><code>protocol &lt;=&gt; interface</code></li>
</ul>
  </div>
  <div class="article_meta">
    <p>Category: <a href="http://devblog.me/category/misc.html">misc</a></p>
    <p>Comments: <a href="#" onclick="javascript:toggleComments();return false;">toggle</a></p>
  </div>

    <div id="article_comments" style="display:none">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
           var disqus_identifier = "cocoa-learning.html";
           (function() {
           var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
           dsq.src = 'http://zdeslavablog.disqus.com/embed.js';
           (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
    </div>

</article>

    <footer>
<p><a href="http://devblog.me/" class="button_accent">&larr; Back to Index</a></p>
<script language="javascript">
    function toggleComments() {
        var commentDiv = document.getElementById("article_comments");
        (commentDiv.style.display == "none") ? commentDiv.style.display = "block" : commentDiv.style.display = "none";
        return false;
    }
</script>
    </footer>

    <div id="ending_message">
      <p>&copy; Slava Kim. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/giulivo/pelican-svbhack" target="_blank">github</a>. .</p>
    </div>
  </main>
</body>
</html>